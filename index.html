<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fox Model Test</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #1a2a6c, #2c3e50);
      color: white;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }
    
    .header {
      text-align: center;
      margin-bottom: 30px;
      padding: 0 20px;
      z-index: 10;
    }
    
    h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      color: #FF6B6B;
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    }
    
    .subtitle {
      font-size: 1.2rem;
      opacity: 0.8;
      max-width: 600px;
    }
    
    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 30px;
      width: 100%;
      max-width: 1000px;
      padding: 20px;
    }
    
    .model-container {
      position: relative;
      width: 100%;
      height: 500px;
      background: rgba(30, 30, 50, 0.5);
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
      border: 2px solid rgba(100, 200, 255, 0.3);
    }
    
    #model-canvas {
      width: 100%;
      height: 100%;
      display: block;
    }
    
    .controls {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      justify-content: center;
      width: 100%;
    }
    
    .control-btn {
      background: linear-gradient(135deg, #4ECDC4, #3bb5ac);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 50px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 5px 15px rgba(78, 205, 196, 0.4);
      display: flex;
      align-items: center;
      gap: 10px;
      min-width: 220px;
    }
    
    .control-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(78, 205, 196, 0.6);
    }
    
    .control-btn:active {
      transform: translateY(1px);
    }
    
    .control-btn.secondary {
      background: linear-gradient(135deg, #FF6B6B, #ff5252);
      box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
    }
    
    .control-btn.secondary:hover {
      box-shadow: 0 8px 20px rgba(255, 107, 107, 0.6);
    }
    
    .status-panel {
      background: rgba(0, 0, 0, 0.7);
      padding: 15px 25px;
      border-radius: 15px;
      font-size: 1.1rem;
      margin-top: 20px;
      text-align: center;
      border: 1px solid rgba(100, 200, 255, 0.3);
      width: 100%;
      max-width: 800px;
    }
    
    #status-text {
      color: #FFE66D;
      font-weight: 500;
    }
    
    .loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 2rem;
      color: #FF6B6B;
      z-index: 5;
    }
    
    .debug-info {
      background: rgba(20, 20, 40, 0.8);
      padding: 15px;
      border-radius: 12px;
      margin-top: 20px;
      width: 100%;
      max-width: 800px;
    }
    
    .debug-title {
      color: #4ECDC4;
      margin-bottom: 10px;
      text-align: center;
    }
    
    .debug-content {
      font-family: monospace;
      background: rgba(0, 0, 0, 0.4);
      padding: 15px;
      border-radius: 8px;
      max-height: 200px;
      overflow-y: auto;
    }
    
    .model-info {
      display: flex;
      justify-content: space-around;
      width: 100%;
      max-width: 800px;
      margin-top: 20px;
      flex-wrap: wrap;
      gap: 20px;
    }
    
    .info-card {
      background: rgba(30, 30, 50, 0.6);
      padding: 20px;
      border-radius: 15px;
      flex: 1;
      min-width: 250px;
      border: 1px solid rgba(100, 200, 255, 0.2);
    }
    
    .info-card h3 {
      color: #FF6B6B;
      margin-bottom: 15px;
      text-align: center;
    }
    
    .info-item {
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
    }
    
    .info-label {
      color: #4ECDC4;
    }
    
    .info-value {
      font-weight: 500;
    }
    
    @media (max-width: 768px) {
      .model-container {
        height: 400px;
      }
      
      .control-btn {
        width: 100%;
        max-width: 350px;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>Fox Model Test</h1>
    <p class="subtitle">This page tests loading and displaying the 3D fox model. Use the controls to interact with the model.</p>
  </div>
  
  <div class="container">
    <div class="model-container">
      <canvas id="model-canvas"></canvas>
      <div class="loading" id="loading">Loading model...</div>
    </div>
    
    <div class="controls">
      <button class="control-btn" id="load-model">
        <span>ðŸ¦Š</span> Load Fox Model
      </button>
      <button class="control-btn secondary" id="reset-model">
        <span>ðŸ”„</span> Reset Model
      </button>
      <button class="control-btn" id="rotate-toggle">
        <span>ðŸ”„</span> Toggle Rotation
      </button>
    </div>
    
    <div class="status-panel">
      Status: <span id="status-text">Ready to load model</span>
    </div>
    
    <div class="model-info">
      <div class="info-card">
        <h3>Model Information</h3>
        <div class="info-item">
          <span class="info-label">File:</span>
          <span class="info-value">fox_rig_finished_walk_cycle_progressive_stop.glb</span>
        </div>
        <div class="info-item">
          <span class="info-label">Type:</span>
          <span class="info-value">GLB (Binary GLTF)</span>
        </div>
        <div class="info-item">
          <span class="info-label">Size:</span>
          <span class="info-value">Approx. 1-5 MB</span>
        </div>
      </div>
      
      <div class="info-card">
        <h3>Test Instructions</h3>
        <div class="info-item">
          <span class="info-label">1.</span>
          <span class="info-value">Click "Load Fox Model"</span>
        </div>
        <div class="info-item">
          <span class="info-label">2.</span>
          <span class="info-value">Check status messages</span>
        </div>
        <div class="info-item">
          <span class="info-label">3.</span>
          <span class="info-value">Rotate with mouse</span>
        </div>
      </div>
    </div>
    
    <div class="debug-info">
      <h3 class="debug-title">Debug Information</h3>
      <div class="debug-content" id="debug-output">
        No debug information yet...
      </div>
    </div>
  </div>

  <!-- Three.js Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/loaders/GLTFLoader.js"></script>
  
  <script>
    // å…¨å±€å˜é‡
    let scene, camera, renderer, controls, foxModel, mixer;
    let rotateModel = true;
    const canvas = document.getElementById('model-canvas');
    const statusText = document.getElementById('status-text');
    const debugOutput = document.getElementById('debug-output');
    const loadingElement = document.getElementById('loading');
    
    // åˆå§‹åŒ–åœºæ™¯
    function initScene() {
      // åˆ›å»ºåœºæ™¯
      scene = new THREE.Scene();
      scene.background = new THREE.Color(0x0a192f);
      scene.fog = new THREE.Fog(0x0a192f, 10, 20);
      
      // åˆ›å»ºç›¸æœº
      camera = new THREE.PerspectiveCamera(
        60, 
        canvas.clientWidth / canvas.clientHeight,
        0.1,
        1000
      );
      camera.position.set(0, 1, 5);
      
      // åˆ›å»ºæ¸²æŸ“å™¨
      renderer = new THREE.WebGLRenderer({ 
        canvas, 
        antialias: true,
        alpha: true
      });
      renderer.setSize(canvas.clientWidth, canvas.clientHeight);
      renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
      renderer.shadowMap.enabled = true;
      
      // æ·»åŠ è½¨é“æŽ§åˆ¶
      controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;
      controls.dampingFactor = 0.05;
      controls.screenSpacePanning = false;
      controls.minDistance = 2;
      controls.maxDistance = 10;
      
      // æ·»åŠ ç¯å…‰
      const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
      scene.add(ambientLight);
      
      const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
      directionalLight.position.set(3, 5, 2);
      directionalLight.castShadow = true;
      scene.add(directionalLight);
      
      // æ·»åŠ åŠçƒå…‰
      const hemisphereLight = new THREE.HemisphereLight(0xffffbb, 0x080820, 0.5);
      scene.add(hemisphereLight);
      
      // æ·»åŠ ç®€å•åœ°é¢
      const groundGeometry = new THREE.PlaneGeometry(20, 20);
      const groundMaterial = new THREE.MeshStandardMaterial({ 
        color: 0x1e3d59,
        roughness: 0.8,
        metalness: 0.2
      });
      const ground = new THREE.Mesh(groundGeometry, groundMaterial);
      ground.rotation.x = -Math.PI / 2;
      ground.position.y = -1;
      ground.receiveShadow = true;
      scene.add(ground);
      
      // æ·»åŠ ç½‘æ ¼è¾…åŠ©
      const gridHelper = new THREE.GridHelper(20, 20, 0x4a5568, 0x4a5568);
      scene.add(gridHelper);
      
      // æ·»åŠ åæ ‡è½´è¾…åŠ©
      const axesHelper = new THREE.AxesHelper(3);
      scene.add(axesHelper);
      
      updateStatus("Scene initialized successfully");
      logDebug("Three.js scene initialized with lights and controls");
    }
    
    // åŠ è½½ç‹ç‹¸æ¨¡åž‹
    function loadFoxModel() {
      // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
      loadingElement.style.display = "block";
      updateStatus("Loading fox model...");
      logDebug("Starting model loading process");
      
      // æ¸…é™¤çŽ°æœ‰æ¨¡åž‹
      if (foxModel) {
        scene.remove(foxModel);
        foxModel = null;
      }
      
      // åˆ›å»ºGLTFåŠ è½½å™¨
      const loader = new THREE.GLTFLoader();
      
      // å°è¯•åŠ è½½æ¨¡åž‹
      loader.load(
        'fox_rig_finished_walk_cycle_progressive_stop.glb', 
        (gltf) => {
          // éšè—åŠ è½½æŒ‡ç¤ºå™¨
          loadingElement.style.display = "none";
          
          // èŽ·å–æ¨¡åž‹
          foxModel = gltf.scene;
          
          // è®¾ç½®æ¨¡åž‹ä½ç½®å’Œç¼©æ”¾
          foxModel.scale.set(0.5, 0.5, 0.5);
          foxModel.position.set(0, -0.5, 0);
          
          // æ·»åŠ åˆ°åœºæ™¯
          scene.add(foxModel);
          
          // è®¾ç½®é˜´å½±
          foxModel.traverse((child) => {
            if (child.isMesh) {
              child.castShadow = true;
              child.receiveShadow = true;
            }
          });
          
          // æ£€æŸ¥åŠ¨ç”»
          if (gltf.animations && gltf.animations.length > 0) {
            mixer = new THREE.AnimationMixer(foxModel);
            const action = mixer.clipAction(gltf.animations[0]);
            action.play();
            
            updateStatus("Fox model loaded with animations");
            logDebug(`Model loaded successfully with ${gltf.animations.length} animations`);
          } else {
            updateStatus("Fox model loaded without animations");
            logDebug("Model loaded but no animations found");
          }
          
          logDebug("Fox model loaded successfully");
        },
        (xhr) => {
          // åŠ è½½è¿›åº¦
          const percent = (xhr.loaded / xhr.total * 100).toFixed(2);
          updateStatus(`Loading model: ${percent}%`);
          logDebug(`Model loading progress: ${percent}%`);
        },
        (error) => {
          // åŠ è½½å¤±è´¥
          loadingElement.style.display = "none";
          updateStatus("Model loading failed");
          logDebug(`Model loading error: ${error.message}`);
          console.error("Model loading error:", error);
          
          // åˆ›å»ºå¤‡ç”¨æ¨¡åž‹
          createFallbackModel();
        }
      );
    }
    
    // åˆ›å»ºå¤‡ç”¨æ¨¡åž‹
    function createFallbackModel() {
      updateStatus("Creating fallback model");
      logDebug("Creating placeholder model due to loading failure");
      
      // åˆ›å»ºå‡ ä½•ä½“
      const geometry = new THREE.BoxGeometry(1, 1, 1);
      const material = new THREE.MeshPhongMaterial({ 
        color: 0xFF6B6B,
        emissive: 0x772222,
        shininess: 100,
        wireframe: true
      });
      
      // åˆ›å»ºç½‘æ ¼
      foxModel = new THREE.Mesh(geometry, material);
      foxModel.position.set(0, 0, 0);
      
      // æ·»åŠ åˆ°åœºæ™¯
      scene.add(foxModel);
      
      logDebug("Fallback placeholder model created");
    }
    
    // é‡ç½®æ¨¡åž‹
    function resetModel() {
      if (foxModel) {
        scene.remove(foxModel);
        foxModel = null;
      }
      
      if (mixer) {
        mixer.stopAllAction();
        mixer = null;
      }
      
      updateStatus("Model reset");
      logDebug("Model has been reset");
    }
    
    // åŠ¨ç”»å¾ªçŽ¯
    function animate() {
      requestAnimationFrame(animate);
      
      // æ›´æ–°æŽ§åˆ¶å™¨
      if (controls) {
        controls.update();
      }
      
      // æ›´æ–°åŠ¨ç”»æ··åˆå™¨
      if (mixer) {
        mixer.update(0.016);
      }
      
      // æ—‹è½¬æ¨¡åž‹
      if (rotateModel && foxModel) {
        foxModel.rotation.y += 0.01;
      }
      
      // æ¸²æŸ“åœºæ™¯
      if (renderer && scene && camera) {
        renderer.render(scene, camera);
      }
    }
    
    // æ›´æ–°çŠ¶æ€
    function updateStatus(message) {
      statusText.textContent = message;
    }
    
    // è®°å½•è°ƒè¯•ä¿¡æ¯
    function logDebug(message) {
      const entry = document.createElement('div');
      entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      debugOutput.appendChild(entry);
      debugOutput.scrollTop = debugOutput.scrollHeight;
    }
    
    // åˆå§‹åŒ–
    window.addEventListener('load', () => {
      // åˆå§‹åŒ–åœºæ™¯
      initScene();
      
      // å¯åŠ¨åŠ¨ç”»å¾ªçŽ¯
      animate();
      
      // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
      document.getElementById('load-model').addEventListener('click', loadFoxModel);
      document.getElementById('reset-model').addEventListener('click', resetModel);
      document.getElementById('rotate-toggle').addEventListener('click', () => {
        rotateModel = !rotateModel;
        logDebug(`Model rotation ${rotateModel ? "enabled" : "disabled"}`);
      });
      
      // å“åº”çª—å£å¤§å°å˜åŒ–
      window.addEventListener('resize', () => {
        if (camera && renderer) {
          camera.aspect = canvas.clientWidth / canvas.clientHeight;
          camera.updateProjectionMatrix();
          renderer.setSize(canvas.clientWidth, canvas.clientHeight);
        }
      });
      
      updateStatus("Ready to load model");
      logDebug("Application initialized");
    });
  </script>
</body>
</html>
